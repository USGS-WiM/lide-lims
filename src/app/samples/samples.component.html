<div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" >
        <div class="btn-group">
            <button class="btn btn-sm" (click)="showHideAdd = !showHideAdd">Add Sample</button>
            <button class="btn btn-sm" (click)="showHideEdit = !showHideEdit" [disabled]=" studySelected ? null : showHideAdd ? null: 'disabled' ">Edit Study</button>
            <button class="btn btn-sm" [disabled]="studySelected ? null : 'disabled'" (click)="deleteStudyConfirm = true">Delete Study</button>
        </div>
    </div>
</div>

<!--Add sample card --> 
<div class="row">
    <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12" *ngIf="showHideAdd" >
        <!-- begin card-->
        <div class="card">
            <div class="card-block">
                <div class="card-title">Add Sample</div>

                <div class="card-text">
                    <!-- begin form -->
                    <form class="form compact" [formGroup]="addSampleForm" (ngSubmit)="onSubmit()" [hidden]="submitted" >
                        <section class="form-block">

                            <!-- sample type select form, without Clarity UI validation -->
                            <!--<div class="form-group" >
                                <label for="sampleTypeSelect">Sample type</label>
                                <div class="select">
                                    <select id="sampleTypeSelect" name="sample_type" formControlName="sample_type">
                                        <option value="Default">Select Sample Type...</option>
                                        <option *ngFor="let type of sampleTypes" [value]="type.sample_type_id">{{type.sample_type}}</option>
                                    </select>
                                </div>
                            </div>-->

                            <div class="form-group">
                                <label class="required">Matrix</label>
                                <label for="matrixSelect" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm" [class.invalid]="addSampleForm.get('matrix').invalid && (addSampleForm.get('matrix').dirty || addSampleForm.get('matrix').touched)">
                                    <div class="select">
                                        <select id="matrixSelect" name="matrix" formControlName="matrix" (change)="onMatrixSelect($event.target.value)">
                                            <option *ngFor="let matrix of matrices" [value]="matrix.matrix_cd">{{matrix.matrix}}</option>
                                        </select>
                                    </div>
                                </label>
                            </div>

                             <div class="form-group">
                                <label class="required">Study</label>
                                <label for="studySelect" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm" [class.invalid]="addSampleForm.get('study_name').invalid && (addSampleForm.get('study_name').dirty || addSampleForm.get('study_name').touched)">
                                <div class="select">
                                    <select id="studySelect" name="study_name" formControlName="study_name">
                                        <!-- line below is for adding a default value -->
                                        <!--<option value="Default">Select Study...</option>-->
                                        <option *ngFor="let study of allStudies" [value]="study.study_id">{{study.study_name}}</option>
                                    </select>
                                </div>
                                </label>
                            </div>

                             <div class="form-group">
                                <label class="required">Sample type</label>
                                <label for="sampleTypeSelect" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm" [class.invalid]="addSampleForm.get('sample_type').invalid && (addSampleForm.get('sample_type').dirty || addSampleForm.get('sample_type').touched)">
                                <div class="select">
                                    <select id="sampleTypeSelect" name="sample_type" formControlName="sample_type">
                                        <!-- line below is for adding a default value -->
                                        <!--<option value="Default">Select Sample Type...</option>-->
                                        <option *ngFor="let type of sampleTypes" [value]="type.sample_type_id">{{type.sample_type}}</option>
                                    </select>
                                </div>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="required">Collaborator Sample ID</label>
                                <label for="collabSampleIdInput" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm" [class.invalid]="addSampleForm.get('collab_sample_id').invalid && (addSampleForm.get('collab_sample_id').dirty || addSampleForm.get('collab_sample_id').touched)">
                                    <input id="collabSampleIdInput" type="text" formControlName="collab_sample_id" >
                                    <span class="tooltip-content">Collaborator ID is required.</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="required">Filtered</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="filteredToggle" formControlName="filter_flag">
                                    <label for="filteredToggle">{{this.addSampleForm.controls.filter_flag.value ? "Yes" : "No"}}</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="required">Secondary Concentration</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="secondaryConcToggle" formControlName="secondary_conc_flag">
                                    <label for="secondaryConcToggle">{{this.addSampleForm.controls.secondary_conc_flag.value ? "Yes" : "No"}}</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="studySiteNameInput">Study Site Name</label>
                                <input id="studySiteNameInput" type="text" formControlName="study_site_name" >
                            </div>

                            <div class="form-group">
                                <label for="studySiteIdInput">Study Site ID</label>
                                <input id="studySiteIdInput" type="text" formControlName="study_site_id" >
                            </div>

                            <div class="form-group">
                                <label for="sampleDescInput">Sample Description</label>
                                <textarea id="sampleDescInput" rows="2" formControlName="samp_desc" style="max-width:25em" ></textarea>
                            </div>

                            <div class="form-group">
                                <label for="samplerNameInput">Sampler Name</label>
                                <input id="samplerNameInput" type="text" formControlName="sampler_name">
                            </div>

                            <div class="form-group">
                                <label for="collectStartDateInput" class="required">Collection Start Date</label>
                                <input type="date" id="collectStartDateInput" formControlName="collect_start_date" >
                            </div>

                            <!--begin variable display section-->

                            <div class="form-group">
                                <label for="collectStartTime">Collection Start Time (HHmm)</label>
                                <input id="collectStartTime" type="text" formControlName="collect_start_time">
                            </div>

                            <div class="form-group">
                                <label for="collectEndDateInput">Collection End Date</label>
                                <input type="date" id="collectEndDateInput" formControlName="collect_end_date" >
                            </div>

                            <div class="form-group">
                                <label for="collectEndTime">Collection End Time (HHmm)</label>
                                <input id="collectEndTime" type="text" formControlName="collect_end_time">
                            </div>

                            <div class="form-group">
                                <label for="pumpRateInput">Pump Flow rate</label>
                                <input id="pumpRateInput" type="text" formControlName="pump_rate">
                            </div>

                            <div class="form-group">
                                <label for="imrInput" >Initial Meter Reading</label>
                                 <input type="text" id="imrInput" formControlName="imr">
                                <div class="select">
                                    <select id="imrUnitSelect" formControlName="tvs_units">
                                        <option>Gal</option>
                                        <option>L</option>
                                        <option>g</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="fmrInput">Final Meter Reading</label>
                                 <input type="text" id="fmrInput" formControlName="fmr">
                                 <label>{{addSampleForm.controls.tvs_units.value}}</label>
                            </div>

                            <div class="form-group">
                                <label for="tvsInput">Total Volume Sampled</label>
                                 <input type="text" id="tvsInput" formControlName="tvs">
                                <div class="select">
                                    <select id="tvsUnitSelect">
                                        <option>Gal</option>
                                        <option>L</option>
                                        <option>g</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="volPostDiluteInput">Volume After Dilution</label>
                                <input id="volPostDiluteInput" type="text" formControlName="vol_post_dilution_ul">
                            </div>

                            <!--come back and make this a dropdown -->
                            <div class="form-group">
                                <label for="filterTypeInput">Filter Type</label>
                                <input id="filterTypeInput" type="text" formControlName="filter_type">
                            </div>

                            <div class="form-group">
                                <label for="filterBornOnDateInput">Collection Start Date</label>
                                <input type="date" id="filterBornOnDateInput" formControlName="filt_bornon_date" >
                            </div>

                            <div class="form-group">
                                <label for="dissVolInput">Dissolution Volume (mL)</label>
                                <input id="dissVolInput" type="text" formControlName="air_subsample_vol_ml">
                            </div>

                            <div class="form-group">
                                <label for="eluteDateInput">Elution Date</label>
                                <input type="date" id="eluteDateInput" formControlName="elute_date" >
                            </div>

                            <div class="form-group">
                                <label for="eluteNotesInput">Elution Notes</label>
                                <textarea id="eluteNotesInput" rows="2" formControlName="elute_notes" style="max-width:25em"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="techInitInput">Tech Intials</label>
                                <input id="techInitInput" type="text" formControlName="tech_init">
                            </div>

                            <div class="form-group">
                                <label for="eluteVolInput">Eluent/Backflish Volume Used</label>
                                <input id="eluteVolInput" type="text" formControlName="init_vol">
                            </div>

                            <button class="btn btn-primary" type="submit" [disabled]="addSampleForm.invalid">Add</button>
                            <button class="btn btn-info" (click)="showHideAdd = !showHideAdd">Cancel</button>
                        </section>
                        <p>Form value: {{ addSampleForm.value | json }}</p>
                        <p>Form status: {{ addSampleForm.status | json }}</p> 
                    </form>
                    <!-- end form -->
                </div> 
            </div>
        <!-- end card -->
        </div>   
    </div>
</div>

<div class="row"> 
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-block">
                <div class="card-title">
                    All Samples
                </div>
                <div class="card-text">
                <p-dataTable [value]="allSamples"  [scrollable]="true" scrollWidth="100%" [style]="{'margin-top':'30px'}" selectionMode="single" [(selection)]="selectedSample" (onRowSelect)="onRowSelect($event)" (onRowUnselect)="onRowUnselect($event)">
                    <p-column field="sample_id" header="Sample ID" [editable]="true" [style]="{'width':'5em'}" ></p-column>
                    <p-column field="study_name" header="Name"  [sortable]="true" [filter]="true" filterPlaceholder="Search" [editable]="true" [style]="{'width':'10em'}"></p-column>
                    <p-column field="collab_sample_id" header="Collaborator Sample ID" [editable]="true" [style]="{'width':'8em'}"></p-column>
                    <p-column field="sample_type" header="Sample Type" [editable]="true" [style]="{'width':'8em'}"></p-column>
                    <p-column field="samp_desc" header="Sample Description" [editable]="true" [style]="{'width':'8em'}"></p-column>
                    <p-column field="matrix" header="Matrix" [editable]="true" [style]="{'width':'5em'}"></p-column>
                    <p-column field="filter_flag" header="Filtered" [editable]="true" [style]="{'width':'5em'}"></p-column>
                    <p-column field="secondary_conc_flag" header="Secondary Concentration" [editable]="true"  [style]="{'width':'8em'}"></p-column>
                    <p-column field="samp_vol_filt" header="Sample Volume Filtered" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="tvs_units" header="Units" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="imr" header="IMR" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="fmr" header="FMR" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="units" header="Meter Units" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    
                    <p-column field="air_subsample_vol_ml" header="Air Subsample Volume (mL)" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="vol_post_dilution_ul" header="Volume After Dilution (uL)" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="filter_type" header="Filter Type" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="filt_bornon_date" header="Filter Born On Date" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="collect_start_date" header="Collect Start Date" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="collect_end_date" header="Collect End Date" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <!-- insert a calculated filter time field ?-->
                    <p-column field="study_site_name" header="Study Site Name" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="study_site_id" header="Study Site ID" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="sampler_name" header="Sampler Nae" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="sample_notes" header="Sample Notes" [editable]="true"  [style]="{'width':'10em'}"></p-column>
                    <p-column field="study_site_name" header="Study Site Name" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="study_site_id" header="Study Site ID" [editable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="insert_user" header="Added by"  [sortable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="insert_date" header="Date added"  [sortable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="update_user" header="Updated by"  [sortable]="true"  [style]="{'width':'5em'}"></p-column>
                    <p-column field="update_date" header="Date updated"  [sortable]="true"  [style]="{'width':'5em'}"></p-column>
                    <!--<p-footer>
                        <ul>
                            <li *ngFor="let study of selectedStudies" style="text-align: left">{{study.study_name}}</li>
                        </ul>
                    </p-footer>-->
                    <p-footer><div style="text-align: left">Selected Study: {{selectedStudy ? selectedStudy.study_name: 'none'}}</div></p-footer>
                </p-dataTable>
                </div> 
            </div>
        </div>
    </div>
</div>


