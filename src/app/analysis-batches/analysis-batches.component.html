<!-- Extract wizard -->
<clr-wizard #wizardExtract [(clrWizardOpen)]="extractWizardOpen" (clrWizardOnFinish)="finishExtractWizard(selectedAnalysisBatchID, extractionForm.value, addRTForm.value, createInhibitionForm.value)"
    (clrWizardOnCancel)="resetExtractWizard()" clrWizardSize="xl">
    <clr-wizard-title>Extract Samples in Analysis Batch {{selectedAnalysisBatchID}}</clr-wizard-title>

    <clr-wizard-button [type]="'cancel'">Cancel</clr-wizard-button>
    <clr-wizard-button [type]="'previous'">Back</clr-wizard-button>
    <clr-wizard-button [type]="'next'">Next</clr-wizard-button>
    <!-- <clr-wizard-button [type]="'finish'">Finish</clr-wizard-button> -->

    <!-- Aliquot selection page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>Aliquot Selection</ng-template>
        <div class="row">
            <div class="col-lg-10 col-md-10">
                <p>Select an aliquot for each Sample in this Analysis Batch

                    <form class="compact">
                        <section class="form-block">

                            <div class="form-group" *ngFor="let sample of abSampleList">
                                <label for="">Sample {{sample.id}}</label>

                                <span *ngIf="sample.aliquots.length === 0">No aliquots recorded</span>
                                <div class="select" *ngIf="sample.aliquots.length > 0">
                                    <select id="" name="aliquot_select" (change)="onAliquotSelect(sample.id, $event.target.value)">
                                        <option *ngFor="let aliquot of sample.aliquots" [value]="aliquot.aliquot_string">{{aliquot.aliquot_string}}</option>
                                    </select>
                                </div>
                            </div>

                        </section>
                    </form>
            </div>
            <div class="col-lg-2 col-md-2"></div>
        </div>
    </clr-wizard-page>
    <!-- end Aliquot selection page -->

    <!-- Target selection page -->
    <clr-wizard-page [clrWizardPageNextDisabled]="selected.length < 1" (clrWizardPageCustomButton)="doCustomClick($event)">
        <ng-template clrPageTitle>Target Selection</ng-template>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                Select targets to analyze for this extraction from the table below
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 col-md-10 col-sm-12">
                <clr-datagrid class="target-select-datagrid" [(clrDgSelected)]="selected">

                    <clr-dg-column [clrDgField]="'name'">Name</clr-dg-column>
                    <clr-dg-column [clrDgField]="'code'">Code</clr-dg-column>
                    <clr-dg-column [clrDgField]="'type'">Type</clr-dg-column>

                    <clr-dg-row *clrDgItems="let target of allTargets" [clrDgItem]="target">
                        <clr-dg-cell>{{target.name}}</clr-dg-cell>
                        <clr-dg-cell>{{target.code}}</clr-dg-cell>
                        <clr-dg-cell>{{target.nucleic_acid_type }}</clr-dg-cell>
                    </clr-dg-row>

                    <clr-dg-footer>{{allTargets.length}} targets</clr-dg-footer>
                </clr-datagrid>

            </div>
            <div class="col-lg-2 col-md-2"></div>
        </div>
        <ng-template clrPageButtons>
            <clr-wizard-button [type]="'custom-cancel'">Cancel</clr-wizard-button>
            <clr-wizard-button [type]="'custom-previous'">Back</clr-wizard-button>
            <clr-wizard-button [type]="'custom-next'">Next</clr-wizard-button>
        </ng-template>

    </clr-wizard-page>
    <!-- end Target selection page -->

    <!-- qPCR details page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>qPCR Details</ng-template>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <form id="extractForm" class="compact" [formGroup]="extractForm" (ngSubmit)="onSubmit('add', extractionForm.value)">
                    <section class="form-block">

                        <div class="form-group">
                            <label for="qpcrTemplateVol">qPCR Template Volume</label>
                            <input id="qpcrTemplateVol" type="text" size="5" formControlName="qpcr_template_volume">
                            <span>µL</span>
                        </div>

                        <div class="form-group">
                            <label for="qpcrReactionVol">qPCR Reaction Volume</label>
                            <input id="qpcrReactionVol" type="text" size="5" formControlName="qpcr_reaction_volume">
                            <span>µL</span>
                        </div>

                        <div class="form-group">
                            <label for="qpcrDateInput">qPCR Date</label>
                            <input type="date" id="qpcrDateInput" formControlName="qpcr_date">
                        </div>
                    </section>

                    <section class="form-block" *ngIf="x">

                        <p>Select desired number of PCR replicates for each selected target. To update the targets list, return
                            to Target Selection page.

                            <div formArrayName="replicates">
                                <div class="form-group" *ngFor="let target of replicateArray.controls; let i = index" [formGroupName]="i">
                                    <label>{{target.controls.target.value | displayValue:'name':this.allTargets}}</label>
                                    <input formControlName="count" type="number" class="target-count-input">

                                </div>
                            </div>

                            <!-- 
                            <table formArrayName="replicates">
                                <tr>
                                    <th>Target</th>
                                    <th>Count</th>
                                </tr>
                                <tr *ngFor="let target of replicateArray.controls; let i = index" [formGroupName]="i">
                                    <td>
                                        <label>{{target.controls.target.value | displayValue:'name':this.allTargets}}</label>
                                    </td>
                                    <td>
                                        <input formControlName="count" type="number" size="5">
                                    </td>
                                </tr>
                            </table> -->

                    </section>
                </form>
                <!-- <div class="form-group" *ngFor="let target of selected">
                     <label>{{target.name}} ({{target.code}})</label>
                 <input type="number" class="target-count-input" [(ngModel)]="target.count" name="targetCount">
                </div> -->
            </div>
        </div>
    </clr-wizard-page>
    <!-- end qPCR details page -->

    <!-- extraction (batch) details page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>Extraction Details</ng-template>

        <form id="extractionForm" class="compact" [formGroup]="extractForm" (ngSubmit)="onSubmit('add', extractionForm.value)">
            <section class="form-block">

                <div class="form-group">
                    <label for="extractVol">Extraction Volume</label>
                    <input id="extractVol" type="text" size="10" formControlName="extraction_volume">
                    <span>µL</span>
                </div>

                <div class="form-group">
                    <label for="elutionVol">Elution Volume</label>
                    <input id="elutionVol" type="text" size="10" formControlName="elution_volume">
                    <span>µL</span>
                </div>

                <div class="form-group">
                    <label for="elutionVol">Extraction Method</label>
                    <div class="select">
                        <select id="extractionMethodSelect" name="extraction_method" formControlName="extraction_method">
                            <option *ngFor="let method of allExtractionMethods" [value]="method.id">{{method.name}}</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="sampleDilution">Dilution factor of Sample</label>
                    <input id="sampleDilution" type="text" size="10" formControlName="sample_dilution_factor">
                </div>

                <div class="form-group">
                    <label for="extractionDateInput">Extraction Date</label>
                    <input type="date" id="extractionDateInput" formControlName="extraction_date">
                </div>
            </section>
        </form>

    </clr-wizard-page>
    <!-- extraction (batch) details page -->

    <!-- Reverse Transcription page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>Reverse Transcription</ng-template>
        <clr-alert [clrAlertClosable]="false" *ngIf="rnaTargetsSelected">
            <div clr-alert-item class="alert-item">
                <span class="alert-text">
                    You have selected RNA targets for this extraction. Please enter RT data below.
                </span>
            </div>
        </clr-alert>

        <clr-alert [clrAlertClosable]="false" *ngIf="!rnaTargetsSelected">
            <div clr-alert-item class="alert-item">
                <span class="alert-text">
                    You have not selected any RNA targets for this extraction. No RT record will be created. Please click Next to skip to the
                    next step.
                </span>
            </div>
        </clr-alert>

        <form id="addRTForm" class="compact" [formGroup]="extractForm" (ngSubmit)="onSubmit('add', addRTForm.value)" *ngIf="rnaTargetsSelected">
            <section class="form-block">

                <div formGroupName="rt">

                    <div class="form-group">
                        <label for="templateVol">Template Volume</label>
                        <input id="templateVol" type="text" size="10" formControlName="template_volume">
                        <span>µL</span>
                    </div>

                    <div class="form-group">
                        <label for="reactionVol">Reaction Volume</label>
                        <input id="reactionVol" type="text" size="10" formControlName="reaction_volume">
                        <span>µL</span>
                    </div>

                    <div class="form-group">
                        <label for="rtDateInput" class="required">RT Date</label>
                        <input type="date" id="rtDateInput" formControlName="rt_date">
                    </div>

                </div>

            </section>
        </form>
    </clr-wizard-page>
    <!-- end Reverse Transcription page -->

    <!-- Inhibition page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>Inhibition</ng-template>
        <div>

            <clr-alert [clrAlertClosable]="false" *ngIf="inhibitionsExist">
                <div clr-alert-item class="alert-item">
                    <span class="alert-text">
                        lili has detected an existing inhibition for this Analysis Batch
                    </span>
                    <div class="alert-actions">
                        <a class="alert-actions" (click)="showApplyExistingCard()">Apply Existing Inhibition</a>
                    </div>

                </div>
            </clr-alert>

            <div class="row">
                <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12" *ngIf="!useExistingInhibition">
                    <div class="card">
                        <div class="card-header">
                            Create New Inhibition
                            <clr-signpost>
                                <clr-signpost-content *clrIfOpen>
                                    <p>This option allows you to create one or two new inhibition records. If you choose one
                                        type, an inhibition of that type will be created and associated with every replicate
                                        from the batch regardless of target type. If you choose both types, two inhibition
                                        records will be created and associated with replicates of the corresponding targets.
                                    </p>
                                </clr-signpost-content>
                            </clr-signpost>
                        </div>

                        <div class="card-block">
                            <div class="card-text">
                                <form id="createInhibitionForm" class="compact" [formGroup]="createInhibitionForm" (ngSubmit)="onSubmit('add', createInhibitionForm.value)">
                                    <section class="form-block">

                                        <div class="form-group">
                                            <label>Inhibition Type</label>
                                            <div class="checkbox">
                                                <input type="checkbox" formControlName="dna" id="dnaCheck">
                                                <label for="dnaCheck">DNA</label>
                                            </div>
                                            <div class="checkbox">
                                                <input type="checkbox" formControlName="rna" id="rnaCheck" checked>
                                                <label for="rnaCheck">RNA</label>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <input type="date" id="inhibitionDateInput" formControlName="inhibition_date">
                                        </div>

                                    </section>
                                </form>
                            </div>
                        </div>
                        <div class="card-footer" *ngIf="inhibitionsExist">
                            <button class="btn btn-sm btn-link" (click)="showApplyExistingCard()">Apply Existing Inhibition Instead</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" *ngIf="useExistingInhibition">
                    <div class="card">
                        <div class="card-header">
                            Apply Existing Inhibition
                        </div>
                        <div class="card-block">
                            <div class="card-text">
                                <form id="extractionForm" class="compact" [formGroup]="applyInhibition_batchForm" (ngSubmit)="onSubmit('add', applyInhibition_batchForm.value)">
                                    <section class="form-block">

                                        <div class="form-group">
                                            <label for="inhibitionDateInput">Inhibition Date (for new Inhibitions)</label>
                                            <input type="date" id="inhibitionDateInput" formControlName="inhibition_date">
                                        </div>

                                    </section>
                                </form>

                            </div>
                        </div>
                        <div class="card-block">
                            <div class="card-title">
                                Batch Level
                                <clr-signpost>
                                    <clr-signpost-content *clrIfOpen>
                                        <p>Make a single selection from existing inhibitions to apply to every DNA target and
                                            every RNA target for every sample in this batch. </p>
                                    </clr-signpost-content>
                                </clr-signpost>
                            </div>
                            <div class="card-text">
                                <form id="extractionForm" class="compact" [formGroup]="applyInhibition_batchForm" (ngSubmit)="onSubmit('add', applyInhibition_batchForm.value)">
                                    <section class="form-block">
                                        <div class="form-group">
                                            <label for="elutionVol">Inhibition for DNA targets</label>
                                            <div class="select">
                                                <select id="inhibitionSelect_batchDNA" name="dnaInhibition" formControlName="dnaInhibition">
                                                    <option *ngFor="let inhibition of abInhibitions" [value]="inhibition.id">Inh-{{inhibition.id}} ({{inhibition.type}})</option>
                                                    <option [value]="0">Create New Inhibition</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="elutionVol">Inhibition for RNA targets</label>
                                            <div class="select">
                                                <select id="inhibitionSelect_batchRNA" name="rnaInhibition" formControlName="rnaInhibition">
                                                    <option *ngFor="let inhibition of abInhibitions" [value]="inhibition.id">Inh {{inhibition.id}} ({{inhibition.type}})</option>
                                                    <option>Create New Inhibition</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- <div class="form-group">
                                            <label for="inhibitionDateInput">Inhibition Date (for new Inhibitions)</label>
                                            <input type="date" id="inhibitionDateInput" formControlName="inhibition_date">
                                        </div> -->

                                    </section>
                                </form>
                            </div>
                        </div>


                        <div class="card-block">
                            <div class="card-title">
                                Sample Level
                                <clr-signpost>
                                    <clr-signpost-content *clrIfOpen>
                                        <p>Select existing inhibitions to apply to every DNA target and every RNA target for
                                            each sample individually. </p>
                                    </clr-signpost-content>
                                </clr-signpost>
                            </div>
                            <div class="card-text">

                                <form id="createInhibitionForm" class="compact" [formGroup]="createInhibitionForm" (ngSubmit)="onSubmit('add', createInhibitionForm.value)">
                                    <section class="form-block">

                                        <div class="form-group">
                                            <label>Create New Inhibition </label>
                                            <div class="checkbox">
                                                <input type="checkbox" formControlName="dna" id="dnaCheck">
                                                <label for="dnaCheck">DNA targets</label>
                                            </div>
                                            <div class="checkbox">
                                                <input type="checkbox" formControlName="rna" id="rnaCheck" checked>
                                                <label for="rnaCheck">RNA targets</label>
                                            </div>
                                        </div>


                                    </section>
                                </form>

                                <form id="extractForm" class="compact" [formGroup]="extractForm">
                                    <section class="form-block">
                                        <div formArrayName="extractions">

                                            <div>

                                                <!-- <label>{{target.controls.target.value | displayValue:'name':this.allTargets}}</label>
                                                <input formControlName="count" type="number" class="target-count-input"> -->

                                                <clr-datagrid>
                                                    <clr-dg-column>Sample</clr-dg-column>
                                                    <clr-dg-column>Inhibition for DNA Targets</clr-dg-column>
                                                    <clr-dg-column>Inhibition for RNA Targets</clr-dg-column>

                                                    <clr-dg-row *ngFor="let extraction of extractionArray.controls; let i = index" [formGroupName]="i">
                                                        <clr-dg-cell>Sample {{extraction.controls.sample.value}}</clr-dg-cell>
                                                        <clr-dg-cell>
                                                            <div class="select">
                                                                <select id="" name="dnaInhibition">
                                                                    <option *ngFor="let inhibition of sampleInhibitions.inhibitions" [value]="extraction.inhibition_dna">Inh {{inhibition.id}} ({{sample.sample_type}})</option>
                                                                </select>
                                                            </div>
                                                        </clr-dg-cell>
                                                        <clr-dg-cell>
                                                            <div class="select">
                                                                <select id="" name="rnaInhibition">
                                                                    <option *ngFor="let inhibition of sampleInhibitions.inhibitions" [value]="extraction.inhibition_dna">Inh {{inhibition.id}} ({{inhibition.nucleic_acid_type}})</option>
                                                                </select>
                                                            </div>
                                                        </clr-dg-cell>
                                                    </clr-dg-row>
                                                    <clr-dg-footer>{{inhibitionsPerSample.length}} samples</clr-dg-footer>
                                                </clr-datagrid>

                                            </div>
                                        </div>
                                    </section>
                                </form>

                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-sm btn-link" (click)="useExistingInhibition = false">Create New Inhibition Batch-Wide</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <ng-template clrPageButtons>

            <clr-wizard-button (click)="createWorksheet()">Create Worksheet</clr-wizard-button>
            <clr-wizard-button [type]="'cancel'">Cancel</clr-wizard-button>
            <clr-wizard-button [type]="'previous'">Back</clr-wizard-button>
            <clr-wizard-button [type]="'finish'">Finish</clr-wizard-button>
        </ng-template>

    </clr-wizard-page>
    <!-- end Inhibition page -->
</clr-wizard>


<!-- edit analysis batch modal -->
<clr-modal [(clrModalOpen)]="showHideEdit" [clrModalSize]="'xl'">
    <h3 class="modal-title">Edit Analysis Batch {{editABForm.value.id}}</h3>
    <div class="modal-body">

        <div class="row">
            <div class="col-lg-12">
                <clr-tabs>
                    <clr-tab>
                        <button clrTabLink>Details</button>
                        <ng-template [(clrIfActive)]="detailsActive">
                            <clr-tab-content>
                                <form id="editABForm" class="compact" [formGroup]="editABForm" (ngSubmit)="onSubmit('editAB', editABForm.value)">
                                    <section class="form-block">
                                        <div class="form-group">
                                            <label for="studyId">Analysis Batch ID</label>
                                            <input type="text" id="studyId" size="35" formControlName="id" readonly>
                                        </div>

                                        <div class="form-group">
                                            <label for="abDescInput">Analysis Batch Description</label>
                                            <textarea id="abDescInput" rows="2" formControlName="analysis_batch_description" style="max-width:25em"></textarea>
                                        </div>

                                        <div class="form-group">
                                            <label for="abNotesInput">Analysis Batch Notes</label>
                                            <textarea id="abNotesInput" rows="2" formControlName="analysis_batch_notes" style="max-width:25em"></textarea>
                                        </div>

                                        <clr-alert [clrAlertType]="'alert-danger'" *ngIf="showABEditError">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Submission error. Analysis Batch not updated.</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="onSubmitSample('add', editSampleForm.value)">Try again</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <clr-alert [clrAlertType]="'alert-success'" *ngIf="showABEditSuccess">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Analysis successfully updated</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="showHideEdit = false; showABEditSuccess = false">Close</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <button class="btn btn-primary" type="submit" [disabled]="editABForm.invalid" [clrLoading]="submitLoading">Save Edits</button>
                                        <button class="btn btn-info" (click)="showHideEdit = !showHideEdit">Cancel</button>

                                    </section>
                                </form>

                            </clr-tab-content>
                        </ng-template>
                    </clr-tab>

                    <clr-tab>
                        <button clrTabLink>Sample List</button>
                        <ng-template [(clrIfActive)]="sampleListActive">
                            <clr-tab-content>
                                <div class="row">
                                    <div class="col-lg-4">
                                        <!-- form tags used here strictly for formatting convenience. no actual form contained within. -->
                                        <form>
                                            <section class="form-block">
                                                <label>Samples in this Analysis Batch
                                                    <span class="badge badge-light-blue">{{abSampleList.length}}</span>
                                                </label>
                                                <ul class="list">
                                                    <li *ngFor="let sample of abSampleList">{{sample.id}} ({{sample.study.name}})</li>
                                                </ul>
                                            </section>
                                        </form>
                                    </div>
                                    <div class="col-lg-8">


                                        <clr-alert [clrAlertClosable]="false" *ngIf="sampleListEditLocked">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">
                                                    This Analysis Batch has been extracted. Editing of the sample list is locked.
                                                </span>

                                            </div>
                                        </clr-alert>

                                        <form *ngIf="!sampleListEditLocked">
                                            <section class="form-block">
                                                <label>All Samples
                                                    <a href="" role="tooltip" aria-haspopup="true" class="tooltip tooltip-lg">
                                                        <clr-icon shape="info-circle" size="24"></clr-icon>
                                                        <span class="tooltip-content">Check/uncheck to add/remove Sample from Analysis Batch</span>
                                                    </a>
                                                </label>
                                                <clr-datagrid class="target-select-datagrid" [(clrDgSelected)]="selected">
                                                    <!-- <clr-dg-action-bar>
                                                        <div class="btn-group">
                                                            <button type="button" class="btn btn-sm btn-secondary" (click)="onAdd()"><clr-icon shape="plus"></clr-icon> Add Selected</button>
                                                        </div>
                                                    </clr-dg-action-bar> -->

                                                    <!-- filter column header for Sample ID -->
                                                    <clr-dg-column [clrDgField]="'sample_id'">
                                                        Sample ID
                                                        <clr-dg-filter [clrDgFilter]="rangeFilter">

                                                            <range-filter #rangeFilter></range-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <clr-dg-column [clrDgField]="'collaborator_sample_id'">
                                                        <ng-container *clrDgHideableColumn="{hidden: false}">
                                                            Collaborator Sample ID
                                                        </ng-container>
                                                    </clr-dg-column>

                                                    <!-- filter column header for study -->
                                                    <clr-dg-column [clrDgField]="'study'">
                                                        Study
                                                        <clr-dg-filter [clrDgFilter]="studyFilter">
                                                            <study-filter #studyFilter></study-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <!-- filter column header for sample type -->
                                                    <clr-dg-column [clrDgField]="'sample_type'">
                                                        Sample Type
                                                        <clr-dg-filter [clrDgFilter]="sampleTypeFilter">
                                                            <sample-type-filter #sampleTypeFilter></sample-type-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <!-- filter column header for collection start date -->
                                                    <clr-dg-column [clrDgField]="'collection_start_date'">
                                                        Collect Start Date
                                                        <clr-dg-filter [clrDgFilter]="CollectionStartDateFilter">
                                                            <collection-start-date-filter [dateField]="'collection_start_date'" #CollectionStartDateFilter></collection-start-date-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <clr-dg-row *clrDgItems="let sample of allSamples" [clrDgItem]="sample">
                                                        <clr-dg-cell>{{sample.id}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.collaborator_sample_id}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.study.name}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.sample_type. name}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.collection_start_date | date:'shortDate'}}</clr-dg-cell>
                                                    </clr-dg-row>

                                                    <clr-dg-footer>{{allSamples.length}} samples</clr-dg-footer>
                                                </clr-datagrid>
                                            </section>
                                        </form>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <clr-alert [clrAlertType]="'alert-danger'" *ngIf="showABEditError">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Submission error. Analysis Batch not updated.</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="onSubmitSample('add', editSampleForm.value)">Try again</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <clr-alert [clrAlertType]="'alert-success'" *ngIf="showABEditSuccess">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Analysis Batch successfully updated</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="showHideEdit = false; showABEditSuccess = false">Close</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <button class="btn btn-primary" type="submit" [disabled]="editABForm.invalid || sampleListEditLocked" (click)="updateABSampleList(editABForm.value,selected)"
                                            [clrLoading]="submitLoading">Save Edits</button>
                                        <button class="btn btn-info" (click)="showHideEdit = !showHideEdit">Cancel</button>
                                    </div>
                                </div>
                            </clr-tab-content>
                        </ng-template>
                    </clr-tab>



                </clr-tabs>
            </div>
        </div>
    </div>

</clr-modal>

<!-- begin target detail modal -->
<clr-modal [(clrModalOpen)]="showHideTargetDetailModal" [clrModalSize]="'sm'">
    <h3 class="modal-title">Targets analyzed in Analysis Batch {{focusAnalysisBatchID}}</h3>
    <div class="modal-body">

        <div class="row">
            <div class="col-sm-12">

                <table class="table table-compact">
                    <thead>
                        <tr>
                            <th>Target</th>
                            <th>Type</th>
                            <th>Replicates</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let target of targetDetailArray">
                            <td>{{target.name}}</td>
                            <td>{{target.nucleic_acid_type}}</td>
                            <td>{{target.replicates}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</clr-modal>
<!-- end target detail modal -->

<!-- begin Analysis batches table -->
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-block">
                <div class="card-title">
                    All Analysis Batches
                </div>
                <div class="card-text">
                    <clr-datagrid [(clrDgSingleSelected)]="selectedAB">

                        <clr-dg-action-bar>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-secondary" [disabled]="!selectedAB" (click)="editAB(selectedAB)">
                                    <clr-icon shape="note-edit" size="16"></clr-icon> Edit Analysis Batch</button>
                                <button type="button" class="btn btn-sm btn-secondary" [disabled]="!selectedAB" (click)="extractAB(selectedAB)">
                                    <clr-icon shape="login"></clr-icon> Extract</button>
                                <!--<button type="button" class="btn btn-sm btn-secondary" ><clr-icon shape="printer"></clr-icon> Go</button>
                                <button type="button" class="btn btn-sm btn-secondary" > <clr-icon shape="trash"></clr-icon> Up</button>
                                <button type="button" class="btn btn-sm btn-secondary" ><clr-icon shape="note-edit"size="16"></clr-icon> Here</button> -->

                            </div>
                        </clr-dg-action-bar>

                        <clr-dg-column [clrDgField]="'analysis_batch_id'">
                            Analysis Batch ID
                            <clr-dg-filter [clrDgFilter]="rangeFilter">
                                <range-filter #rangeFilter></range-filter>
                            </clr-dg-filter>
                        </clr-dg-column>

                        <clr-dg-column [clrDgField]="'ab_description'">
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Analysis Batch Description
                            </ng-container>
                        </clr-dg-column>

                        <!-- <clr-dg-column [clrDgField]="'studies'">
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Studies
                            </ng-container>
                        </clr-dg-column> -->

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Extraction Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Inhibition Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                RT Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Target Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Analysis Batch Notes
                            </ng-container>
                        </clr-dg-column>


                        <!-- <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Samples
                            </ng-container>
                        </clr-dg-column> -->

                        <clr-dg-column [clrDgField]="'insert_user'">
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Added by
                            </ng-container>
                        </clr-dg-column>

                        <!-- filter column header for date added -->
                        <clr-dg-column [clrDgField]="'insert_date'">
                            Date Added
                            <clr-dg-filter [clrDgFilter]="dateAddedFilter">
                                <date-added-filter [dateField]="'insert_date'" #dateAddedFilter></date-added-filter>
                            </clr-dg-filter>
                        </clr-dg-column>

                        <clr-dg-column [clrDgField]="'update_user'">
                            <ng-container *clrDgHideableColumn="{hidden: true}">
                                Updated by
                            </ng-container>
                        </clr-dg-column>

                        <!-- filter column header for date updated -->
                        <clr-dg-column [clrDgField]="'update_date'">
                            Date Updated
                            <clr-dg-filter [clrDgFilter]="dateUpdatedFilter">
                                <date-updated-filter [dateField]="'update_date'" #dateUpdatedFilter></date-updated-filter>
                            </clr-dg-filter>
                        </clr-dg-column>

                        <!-- begin data table rows -->

                        <clr-dg-row *clrDgItems="let ab of allAnalysisBatchSummaries" [clrDgItem]="ab">

                            <clr-dg-cell>{{ab.id}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.analysis_batch_description}}</clr-dg-cell>
                            <!-- <clr-dg-cell><span *ngFor="let study of ab.studies">{{study.name}}<br></span></clr-dg-cell> -->

                            <clr-dg-cell>{{ab.summary.extraction_count}}</clr-dg-cell>

                            <clr-dg-cell>{{ab.summary.inhibition_count}}</clr-dg-cell>

                            <clr-dg-cell>{{ab.summary.reverse_transcription_count}}</clr-dg-cell>

                            <clr-dg-cell>
                                <a (click)="openTargetDetails(ab.id)" class="label label-blue clickable">{{ab.summary.target_count}}</a>
                            </clr-dg-cell>

                            <clr-dg-cell>{{ab.analysis_batch_notes}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.created_by}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.created_date | date:'shortDate'}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.modified_by }}</clr-dg-cell>
                            <clr-dg-cell>{{ab.modified_date | date:'shortDate'}}</clr-dg-cell>

                            <analysis-batch-detail *clrIfExpanded [selectedABSummary]="ab" ngProjectAs="clr-dg-row-detail"></analysis-batch-detail>

                        </clr-dg-row>

                        <clr-dg-footer>
                            {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}} samples
                            <clr-dg-pagination #pagination [clrDgPageSize]="10"></clr-dg-pagination>
                        </clr-dg-footer>
                    </clr-datagrid>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end samples table -->