<!-- Extract wizard -->
<clr-wizard #wizardExtract [(clrWizardOpen)]="extractWizardOpen" (clrWizardOnFinish)="finishExtractWizard(selectedAnalysisBatchID, extractForm.value, createInhibitionForm.value)"
    (clrWizardOnCancel)="resetExtractWizard()" clrWizardSize="xl">
    <clr-wizard-title>Extract Samples in Analysis Batch {{selectedAnalysisBatchID}}</clr-wizard-title>

    <clr-wizard-button [type]="'cancel'">Cancel</clr-wizard-button>
    <clr-wizard-button [type]="'previous'">Back</clr-wizard-button>
    <clr-wizard-button [type]="'next'">Next</clr-wizard-button>
    <!-- <clr-wizard-button [type]="'finish'">Finish</clr-wizard-button> -->

    <!-- Aliquot selection page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>Aliquot Selection</ng-template>
        <div class="row">
            <div class="col-lg-10 col-md-10">
                <p>Select an aliquot for each Sample in this Analysis Batch

                    <form class="compact">
                        <section class="form-block">

                            <div class="form-group" *ngFor="let sample of abSampleList">
                                <label for="">Sample {{sample.id}}</label>

                                <span *ngIf="sample.aliquots.length === 0">No aliquots recorded</span>
                                <div class="select" *ngIf="sample.aliquots.length > 0">
                                    <select name="aliquot_select" (change)="onAliquotSelect(sample.id, $event.target.value)">
                                        <option *ngFor="let aliquot of sample.aliquots" [value]="aliquot.id">{{aliquot.aliquot_string}}</option>
                                    </select>
                                </div>
                            </div>

                        </section>
                    </form>

                    <!-- alternative method using the embedded aliquots form array -->
                    <!-- <form class="compact" [formGroup]="extractForm">
                        <section class="form-block">
                            <p>Select desired number of PCR replicates for each selected target. To update the targets list,
                                return to Target Selection page.
                                <div formArrayName="new_extractions" *ngIf="extractionArray.controls.length > 0">
                                    <div class="form-group" *ngFor="let extraction of extractionArray.controls; let i = index" [formGroupName]="i">
                                        <label>Sample {{extraction.controls.sample.value}}</label>
                                        <div class="select" formArrayName="aliquots">
                                            <select formControlName="selected_aliquot">
                                                <option *ngFor="let aliquot of extraction.controls.aliquots.controls" [value]="aliquot.controls.aliquot_string.value">{{aliquot.controls.aliquot_string.value}}</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                        </section>
                    </form> -->

            </div>
            <div class="col-lg-2 col-md-2"></div>
        </div>
    </clr-wizard-page>
    <!-- end Aliquot selection page -->

    <!-- Target selection page -->
    <clr-wizard-page (clrWizardPageCustomButton)="doCustomClick($event)">
        <ng-template clrPageTitle>Target Selection</ng-template>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                Select targets to analyze for this extraction from the table below
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <clr-datagrid class="target-select-datagrid" [(clrDgSelected)]="selected">

                    <clr-dg-column [clrDgField]="'name'">Name</clr-dg-column>
                    <clr-dg-column [clrDgField]="'code'">Code</clr-dg-column>
                    <clr-dg-column [clrDgField]="'type'">Type</clr-dg-column>

                    <clr-dg-row *clrDgItems="let target of allTargets" [clrDgItem]="target">
                        <clr-dg-cell>{{target.name}}</clr-dg-cell>
                        <clr-dg-cell>{{target.code}}</clr-dg-cell>
                        <clr-dg-cell>{{target.nucleic_acid_type | displayValue:'name':this.nucleicAcidTypes }}</clr-dg-cell>
                    </clr-dg-row>

                    <clr-dg-footer>{{allTargets.length}} targets</clr-dg-footer>
                </clr-datagrid>

            </div>
            <div class="col-lg-2 col-md-2"></div>
        </div>
        <ng-template clrPageButtons>
            <clr-wizard-button [type]="'custom-cancel'">Cancel</clr-wizard-button>
            <clr-wizard-button [type]="'custom-previous'">Back</clr-wizard-button>
            <clr-wizard-button [type]="'custom-next-targetPage'">Next</clr-wizard-button>
        </ng-template>

    </clr-wizard-page>
    <!-- end Target selection page -->

    <!-- qPCR details page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>qPCR Details</ng-template>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <form class="compact" [formGroup]="extractForm" (ngSubmit)="onSubmit('add', extractForm.value)">
                    <section class="form-block">

                        <div class="form-group">
                            <label class="required">qPCR Template Volume (µL)</label>
                            <label for="qpcrTemplateVol" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                                [class.invalid]="extractForm.get('qpcr_template_volume').invalid && (extractForm.get('qpcr_template_volume').dirty || extractForm.get('qpcr_template_volume').touched)">
                                <input id="qpcrTemplateVol" type="text" size="5" formControlName="qpcr_template_volume">
                                <span class="tooltip-content">
                                    This field cannot be empty!
                                </span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="required">qPCR Reaction Volume(µL)</label>
                            <label for="qpcrReactionVol" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                                [class.invalid]="extractForm.get('qpcr_reaction_volume').invalid && (extractForm.get('qpcr_reaction_volume').dirty || extractForm.get('qpcr_reaction_volume').touched)">
                                <input id="qpcrReactionVol" type="text" size="5" formControlName="qpcr_reaction_volume">
                                <span class="tooltip-content">
                                    This field cannot be empty!
                                </span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="required">qPCR Date</label>
                            <label for="qpcrDateInput" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                                [class.invalid]="extractForm.get('qpcr_reaction_volume').invalid && (extractForm.get('qpcr_reaction_volume').dirty || extractForm.get('qpcr_reaction_volume').touched)">
                                <input type="date" id="qpcrDateInput" formControlName="qpcr_date">

                            </label>
                        </div>

                    </section>

                    <section class="form-block" *ngIf="x">
                        <p>Select desired number of PCR replicates for each selected target. To update the targets list, return
                            to Target Selection page.
                            <div formArrayName="new_replicates">
                                <div class="form-group" *ngFor="let target of replicateArray.controls; let i = index" [formGroupName]="i">
                                    <label>{{target.controls.target.value | displayValue:'name':this.allTargets}}</label>
                                    <input formControlName="count" type="number" class="target-count-input">
                                </div>
                            </div>
                    </section>
                </form>
            </div>
        </div>
    </clr-wizard-page>
    <!-- end qPCR details page -->

    <!-- extraction (batch) details page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>Extraction Details</ng-template>

        <form class="compact" [formGroup]="extractForm" (ngSubmit)="onSubmit('add', extractionForm.value)">
            <section class="form-block">

                <div class="form-group">
                    <label class="required">Extraction Volume (µL)</label>
                    <label for="extractVol" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                        [class.invalid]="extractForm.get('extraction_volume').invalid && (extractForm.get('extraction_volume').dirty || extractForm.get('extraction_volume').touched)">
                        <input id="extractVol" type="text" size="10" formControlName="extraction_volume">
                        <span class="tooltip-content">
                            This field cannot be empty and must be a number!
                        </span>
                    </label>

                </div>

                <div class="form-group">
                    <label class="required">Elution Volume (µL)</label>
                    <label for="elutionVol" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                        [class.invalid]="extractForm.get('elution_volume').invalid && (extractForm.get('elution_volume').dirty || extractForm.get('elution_volume').touched)">
                        <input id="elutionVol" type="text" size="10" formControlName="elution_volume">
                        <span class="tooltip-content">
                            This field cannot be empty and must be a number!
                        </span>
                    </label>

                </div>

                <div class="form-group">
                    <label class="required">Extraction Method</label>
                    <label for="extractionMethodSelect" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                        [class.invalid]="extractForm.get('extraction_method').invalid && (extractForm.get('extraction_method').dirty || extractForm.get('extraction_method').touched)">
                        <div class="select">
                            <select id="extractionMethodSelect" name="extraction_method" formControlName="extraction_method">
                                <option *ngFor="let method of allExtractionMethods" [value]="method.id">{{method.name}}</option>
                            </select>
                        </div>
                        <span class="tooltip-content">
                            This field cannot be empty!
                        </span>
                    </label>
                </div>

                <div class="form-group">
                    <label class="required">Dilution factor of Sample</label>
                    <label for="sampleDilution" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                        [class.invalid]="extractForm.get('sample_dilution_factor').invalid && (extractForm.get('sample_dilution_factor').dirty || extractForm.get('sample_dilution_factor').touched)">
                        <input id="sampleDilution" type="number" size="10" formControlName="sample_dilution_factor">
                        <span class="tooltip-content">
                            This field cannot be empty!
                        </span>
                    </label>
                </div>

                <div class="form-group">
                    <label class="required">Extraction Date</label>
                    <label for="extractionDateInput" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                        [class.invalid]="extractForm.get('extraction_date').invalid && (extractForm.get('extraction_date').dirty || extractForm.get('extraction_date').touched)">
                        <input type="date" id="extractionDateInput" formControlName="extraction_date">
                        <span class="tooltip-content">
                            This field cannot be empty!
                        </span>
                    </label>
                </div>
            </section>
        </form>

    </clr-wizard-page>
    <!-- extraction (batch) details page -->

    <!-- Reverse Transcription page -->
    <clr-wizard-page>
        <ng-template clrPageTitle>Reverse Transcription</ng-template>
        <clr-alert [clrAlertClosable]="false" *ngIf="rnaTargetsSelected">
            <div clr-alert-item class="alert-item">
                <span class="alert-text">
                    You have selected RNA targets for this extraction. Please enter RT data below.
                </span>
            </div>
        </clr-alert>

        <clr-alert [clrAlertClosable]="false" *ngIf="!rnaTargetsSelected">
            <div clr-alert-item class="alert-item">
                <span class="alert-text">
                    You have not selected any RNA targets for this extraction. No RT record will be created. Please click Next to skip to the
                    next step.
                </span>
            </div>
        </clr-alert>

        <form class="compact" [formGroup]="extractForm" *ngIf="rnaTargetsSelected">
            <section class="form-block">

                <div formGroupName="new_rt">
                    <div class="form-group">
                        <label class="required">Template Volume (µL)</label>
                        <label for="rtTemplateVol" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                            [class.invalid]="extractForm.get('new_rt').get('template_volume').invalid && (extractForm.get('new_rt').get('template_volume').dirty || extractForm.get('new_rt').get('template_volume').touched)">
                            <input id="rTtemplateVol" type="text" size="10" formControlName="template_volume">
                            <span class="tooltip-content">
                                This field cannot be empty and must be a number!
                            </span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="required">Reaction Volume (µL)</label>
                        <label for="rtReactionVol" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                            [class.invalid]="extractForm.get('new_rt').get('reaction_volume').invalid && (extractForm.get('new_rt').get('reaction_volume').dirty || extractForm.get('new_rt').get('reaction_volume').touched)">
                            <input id="rtReactionVol" type="text" size="10" formControlName="reaction_volume">
                            <span class="tooltip-content">
                                This field cannot be empty and must be a number!
                            </span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="required">RT Date</label>
                        <label for="rtDateInput" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-sm tooltip-bottom-right"
                            [class.invalid]="extractForm.get('new_rt').get('rt_date').invalid && (extractForm.get('new_rt').get('rt_date').dirty || extractForm.get('new_rt').get('rt_date').touched)">
                            <input type="date" id="rtDateInput" formControlName="rt_date">
                            <span class="tooltip-content">
                                This field cannot be empty!
                            </span>
                        </label>
                    </div>
                </div>

            </section>
        </form>
    </clr-wizard-page>
    <!-- end Reverse Transcription page -->

    <!-- Inhibition page -->
    <clr-wizard-page (clrWizardPageCustomButton)="doCustomClick($event)">
        <ng-template clrPageTitle>Inhibition</ng-template>
        <div>
            <div class="row">
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">


                    <clr-alert *ngIf="inhibitionErrorFlag" [clrAlertType]="'alert-danger'">
                        <div class="alert-item">
                            New inhibition submission failed. Please try again.
                        </div>
                    </clr-alert>

                    <clr-alert *ngIf="inhibitionFinished && !inhibitionErrorFlag" [clrAlertType]="'alert-success'">
                        <div clr-alert-item class="alert-item">
                            <span class="alert-text">New inhibitions successfully created</span>
                        </div>
                    </clr-alert>

                    <div class="spinner" *ngIf="loadingFlag">
                        Loading...
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                    <clr-alert [clrAlertClosable]="false" *ngIf="inhibitionsExist && !loadingFlag">
                        <div clr-alert-item class="alert-item">
                            <span class="alert-text">
                                lili has detected existing inhibitions for samples in this Analysis Batch.
                            </span>
                        </div>
                    </clr-alert>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                    <div class="card" *ngIf="!loadingFlag">
                        <div class="card-block">
                            <div class="card-title">
                                Create New Inhibitions
                                <clr-signpost>
                                    <clr-signpost-content *clrIfOpen>
                                        <p>This option allows you to create new inhibitions for all DNA targets in the batch,
                                            all RNA targets in the batch, or both.
                                        </p>
                                    </clr-signpost-content>
                                </clr-signpost>
                            </div>
                            <div class="card-text">
                                <form id="createInhibitionForm" class="compact" [formGroup]="createInhibitionForm" (ngSubmit)="onSubmit('add', createInhibitionForm.value)">
                                    <section class="form-block">
                                        <label>Create new for all samples in this Analysis Batch</label>
                                        <div class="form-group">
                                            <label>DNA Inhibitions (DNA targets)</label>
                                            <div class="checkbox">
                                                <input type="checkbox" formControlName="dna" id="dnaCheck">
                                                <label for="dnaCheck"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>RNA Inhibitions (RNA targets)</label>
                                            <div class="checkbox">
                                                <input type="checkbox" formControlName="rna" id="rnaCheck">
                                                <label for="rnaCheck"></label>
                                            </div>
                                        </div>
                                    </section>
                                    <section class="form-block">
                                        <label>Inhibition date for new inhibitions</label>
                                        <div class="form-group">
                                            <label>New DNA Inhibitions Date</label>
                                            <input type="date" id="inhibitionDateInput" formControlName="inhibition_date_dna">
                                        </div>
                                        <div class="form-group">
                                            <label>New RNA Inhibitions Date</label>
                                            <input type="date" id="inhibitionDateInput" formControlName="inhibition_date_rna">
                                        </div>
                                    </section>
                                </form>
                            </div>

                        </div>

                        <div class="card-block" *ngIf="inhibitionsExist && (createInhibitionForm.value.dna === false || createInhibitionForm.value.rna === false)">
                            <div class="card-title">
                                Apply Existing Inhibitions
                                <clr-signpost>
                                    <clr-signpost-content *clrIfOpen>
                                        <p>Select existing inhibitions to apply to DNA targets and RNA targets for each sample
                                            individually. </p>
                                    </clr-signpost-content>
                                </clr-signpost>
                            </div>
                            <div class="card-text">

                                <form class="compact" [formGroup]="extractForm">
                                    <section class="form-block">
                                        <div formArrayName="new_extractions">
                                            <div>
                                                <table class="table table-noborder">
                                                    <thead>
                                                        <tr>
                                                            <th class="left">Sample</th>
                                                            <th class="left" *ngIf="createInhibitionForm.value.dna === false">Inhibition for DNA Targets</th>
                                                            <th class="left" *ngIf="createInhibitionForm.value.rna === false">Inhibition for RNA Targets</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let extraction of extractionArray.controls; let i = index" [formGroupName]="i">
                                                            <td class="left">
                                                                <label class="required">Sample {{extraction.controls.sample.value}}</label>
                                                            </td>
                                                            <td *ngIf="createInhibitionForm.value.dna === false">
                                                                <div class="select">
                                                                    <select name="dnaInhibition" formControlName="inhibition_dna">
                                                                        <option [value]="'new'">Create New</option>
                                                                        <option *ngFor="let inhibition of sampleInhibitions" [value]="inhibition.id">Inh {{inhibition.id}} ({{inhibition.nucleic_acid_type
                                                                            | displayValue:'name':this.nucleicAcidTypes}})
                                                                            - Sample {{inhibition.sample}}</option>
                                                                    </select>
                                                                </div>
                                                            </td>
                                                            <td *ngIf="createInhibitionForm.value.rna === false">
                                                                <div class="select">
                                                                    <select name="rnaInhibition" formControlName="inhibition_rna">
                                                                        <option [value]="'new'">Create New</option>
                                                                        <option *ngFor="let inhibition of sampleInhibitions" [value]="inhibition.id">Inh {{inhibition.id}} ({{inhibition.nucleic_acid_type
                                                                            | displayValue:'name':this.nucleicAcidTypes}})
                                                                            - Sample {{inhibition.sample}}</option>
                                                                    </select>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </section>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        extractFormStatus: {{extractForm.status}}

        <ng-template clrPageButtons>
            <clr-wizard-button [type]="'custom-cancel'">Cancel</clr-wizard-button>
            <clr-wizard-button [type]="'custom-previous'">Back</clr-wizard-button>
            <clr-wizard-button [type]="'custom-next-inhPage'">Next</clr-wizard-button>
        </ng-template>

    </clr-wizard-page>

    <clr-wizard-page (clrWizardPageCustomButton)="doCustomClick($event)">
        <ng-template clrPageTitle>Confirmation</ng-template>

        <clr-alert *ngIf=!extractForm.valid [clrAlertType]="'alert-danger'">
            <div class="alert-item">
                There are required values missing. Please return to previous pages and enter all required fields.
            </div>
        </clr-alert>

        <div class="spinner" *ngIf="loadingFlag">
            Loading...
        </div>

        <clr-alert *ngIf="extractionErrorFlag" [clrAlertType]="'alert-danger'">
            <div class="alert-item">
                New extraction submission failed. Please try again.
            </div>
        </clr-alert>

        <clr-alert *ngIf="extractionFinished && !extractionErrorFlag" [clrAlertType]="'alert-success'">
            <div clr-alert-item class="alert-item">
                <span class="alert-text">New extraction successfully created!</span>
            </div>
        </clr-alert>
        <div *ngIf="extractionFinished && !extractionErrorFlag">
            <button class="btn btn-primary" (click)="createWorksheet()">Create Extraction Worksheet</button>
        </div>

        <div *ngIf="extractForm.valid && !loadingFlag && !extractionFinished">

            <div>You are about to extract Analysis Batch {{selectedAnalysisBatchID}}. Please
                confirm the details below.</div>

            <div>
                <label>Extraction</label>
                <ul class="list">
                    <li>Extraction Volume: {{extractForm.value.extraction_volume}} µL</li>
                    <li>Elution Volume: {{extractForm.value.elution_volume}} µL</li>
                    <li>Extraction Method: {{extractForm.value.extraction_method | displayValue:'name':this.allExtractionMethods
                        }}
                    </li>
                    <li>Extraction Date: {{extractForm.value.extraction_date | date:'shortDate'}}</li>
                    <li>Re-Extraction: {{(extractForm.value.reextraction) === null ? 'No' : 'Yes'}}</li>
                    <li>Sample Dilution Factor: {{extractForm.value.sample_dilution_factor}}</li>
                    <li>qPCR Template Volume: {{extractForm.value.qpcr_template_volume}} µL</li>
                    <li>qPCR Reaction Volume: {{extractForm.value.qpcr_reaction_volume}} µL</li>
                    <li>qPCR Date: {{extractForm.value.qpcr_date | date:'shortDate'}}</li>
                </ul>
            </div>

            <div>
                <label>Reverse Transcription</label>
                <ul class="list">
                    <li>Template Volume: {{extractForm.value.new_rt.template_volume}} µL</li>
                    <li>Reaction Volume: {{extractForm.value.new_rt.reaction_volume}} µL</li>
                    <li>RT Date: {{extractForm.value.new_rt.rt_date | date:'shortDate' }}</li>
                    <li>Re-RT: {{ extractForm.value.new_rt.re_rt === null ? 'No' : 'Yes'}}</li>
                </ul>
            </div>

            <label>Inhibitions</label>
            <div *ngIf="createInhibitionForm.value.dna">Creating new inhibitions for all DNA targets, with inhibition date {{createInhibitionForm.value.inhibition_date_dna
                | date:'shortDate'}}</div>

            <div *ngIf="createInhibitionForm.value.rna">Creating new inhibitions for all RNA targets, with inhibition date {{createInhibitionForm.value.inhibition_date_rna
                | date:'shortDate'}}</div>

            <div *ngIf="!createInhibitionForm.value.dna">Applying existing inhibitions for DNA targets for the following samples:
                <ul>
                    <li *ngFor="let sample of dnaApplyList">{{sample}}</li>
                </ul>
            </div>

            <div *ngIf="!createInhibitionForm.value.rna">Applying existing inhibitions for RNA targets for the following samples:
                <ul>
                    <li *ngFor="let sample of rnaApplyList">{{sample}}</li>
                </ul>
            </div>

            <div>
                <label>Analyzing for the following targets:</label>
                <ul>
                    <li *ngFor="let replicate of extractForm.value.new_replicates">{{replicate.count}} replicates {{replicate.target | displayValue:'name':this.allTargets}}</li>
                </ul>
            </div>
        </div>

        <ng-template clrPageButtons>
            <clr-wizard-button (click)="createWorksheet()">Create Worksheet</clr-wizard-button>
            <clr-wizard-button [type]="'cancel'">Cancel</clr-wizard-button>
            <clr-wizard-button [type]="'previous'">Back</clr-wizard-button>
            <clr-wizard-button [type]="'custom-finish-confirmPage'"> {{ extractionFinished ? "Finish" : "Submit Extraction" }}</clr-wizard-button>
        </ng-template>

    </clr-wizard-page>
    <!-- end Inhibition page -->
</clr-wizard>


<!-- edit analysis batch modal -->
<clr-modal [(clrModalOpen)]="showHideEdit" [clrModalSize]="'xl'">
    <h3 class="modal-title">Edit Analysis Batch {{editABForm.value.id}}</h3>
    <div class="modal-body">

        <div class="row">
            <div class="col-lg-12">
                <clr-tabs>
                    <clr-tab>
                        <button clrTabLink>Details</button>
                        <ng-template [(clrIfActive)]="detailsActive">
                            <clr-tab-content>
                                <form id="editABForm" class="compact" [formGroup]="editABForm" (ngSubmit)="onSubmit('editAB', editABForm.value)">
                                    <section class="form-block">
                                        <div class="form-group">
                                            <label for="studyId">Analysis Batch ID</label>
                                            <input type="text" id="studyId" size="35" formControlName="id" readonly>
                                        </div>

                                        <div class="form-group">
                                            <label for="abDescInput">Analysis Batch Description</label>
                                            <textarea id="abDescInput" rows="2" formControlName="analysis_batch_description" style="max-width:25em"></textarea>
                                        </div>

                                        <div class="form-group">
                                            <label for="abNotesInput">Analysis Batch Notes</label>
                                            <textarea id="abNotesInput" rows="2" formControlName="analysis_batch_notes" style="max-width:25em"></textarea>
                                        </div>

                                        <clr-alert [clrAlertType]="'alert-danger'" *ngIf="showABEditError">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Submission error. Analysis Batch not updated.</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="onSubmitSample('add', editSampleForm.value)">Try again</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <clr-alert [clrAlertType]="'alert-success'" *ngIf="showABEditSuccess">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Analysis successfully updated</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="showHideEdit = false; showABEditSuccess = false">Close</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <button class="btn btn-primary" type="submit" [disabled]="editABForm.invalid" [clrLoading]="submitLoading">Save Edits</button>
                                        <button class="btn btn-info" (click)="showHideEdit = !showHideEdit">Cancel</button>

                                    </section>
                                </form>

                            </clr-tab-content>
                        </ng-template>
                    </clr-tab>

                    <clr-tab>
                        <button clrTabLink>Sample List</button>
                        <ng-template [(clrIfActive)]="sampleListActive">
                            <clr-tab-content>
                                <div class="row">
                                    <div class="col-lg-4">
                                        <!-- form tags used here strictly for formatting convenience. no actual form contained within. -->
                                        <form>
                                            <section class="form-block">
                                                <label>Samples in this Analysis Batch
                                                    <span class="badge badge-light-blue">{{abSampleList.length}}</span>
                                                </label>
                                                <ul class="list">
                                                    <li *ngFor="let sample of abSampleList">{{sample.id}} ({{sample.study.name}})</li>
                                                </ul>
                                            </section>
                                        </form>
                                    </div>
                                    <div class="col-lg-8">


                                        <clr-alert [clrAlertClosable]="false" *ngIf="sampleListEditLocked">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">
                                                    This Analysis Batch has been extracted. Editing of the sample list is locked.
                                                </span>

                                            </div>
                                        </clr-alert>

                                        <form *ngIf="!sampleListEditLocked">
                                            <section class="form-block">
                                                <label>All Samples
                                                    <a href="" role="tooltip" aria-haspopup="true" class="tooltip tooltip-lg">
                                                        <clr-icon shape="info-circle" size="24"></clr-icon>
                                                        <span class="tooltip-content">Check/uncheck to add/remove Sample from Analysis Batch</span>
                                                    </a>
                                                </label>
                                                <clr-datagrid class="target-select-datagrid" [(clrDgSelected)]="selected">
                                                    <!-- <clr-dg-action-bar>
                                                        <div class="btn-group">
                                                            <button type="button" class="btn btn-sm btn-secondary" (click)="onAdd()"><clr-icon shape="plus"></clr-icon> Add Selected</button>
                                                        </div>
                                                    </clr-dg-action-bar> -->

                                                    <!-- filter column header for Sample ID -->
                                                    <clr-dg-column [clrDgField]="'sample_id'">
                                                        Sample ID
                                                        <clr-dg-filter [clrDgFilter]="rangeFilter">

                                                            <range-filter #rangeFilter></range-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <clr-dg-column [clrDgField]="'collaborator_sample_id'">
                                                        <ng-container *clrDgHideableColumn="{hidden: false}">
                                                            Collaborator Sample ID
                                                        </ng-container>
                                                    </clr-dg-column>

                                                    <!-- filter column header for study -->
                                                    <clr-dg-column [clrDgField]="'study'">
                                                        Study
                                                        <clr-dg-filter [clrDgFilter]="studyFilter">
                                                            <study-filter #studyFilter></study-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <!-- filter column header for sample type -->
                                                    <clr-dg-column [clrDgField]="'sample_type'">
                                                        Sample Type
                                                        <clr-dg-filter [clrDgFilter]="sampleTypeFilter">
                                                            <sample-type-filter #sampleTypeFilter></sample-type-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <!-- filter column header for collection start date -->
                                                    <clr-dg-column [clrDgField]="'collection_start_date'">
                                                        Collect Start Date
                                                        <clr-dg-filter [clrDgFilter]="CollectionStartDateFilter">
                                                            <collection-start-date-filter [dateField]="'collection_start_date'" #CollectionStartDateFilter></collection-start-date-filter>
                                                        </clr-dg-filter>
                                                    </clr-dg-column>

                                                    <clr-dg-row *clrDgItems="let sample of allSamples" [clrDgItem]="sample">
                                                        <clr-dg-cell>{{sample.id}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.collaborator_sample_id}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.study.name}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.sample_type. name}}</clr-dg-cell>
                                                        <clr-dg-cell>{{sample.collection_start_date | date:'shortDate'}}</clr-dg-cell>
                                                    </clr-dg-row>

                                                    <clr-dg-footer>{{allSamples.length}} samples</clr-dg-footer>
                                                </clr-datagrid>
                                            </section>
                                        </form>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <clr-alert [clrAlertType]="'alert-danger'" *ngIf="showABEditError">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Submission error. Analysis Batch not updated.</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="onSubmitSample('add', editSampleForm.value)">Try again</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <clr-alert [clrAlertType]="'alert-success'" *ngIf="showABEditSuccess">
                                            <div clr-alert-item class="alert-item">
                                                <span class="alert-text">Analysis Batch successfully updated</span>
                                                <div class="alert-actions">
                                                    <a class="alert-action" (click)="showHideEdit = false; showABEditSuccess = false">Close</a>
                                                </div>
                                            </div>
                                        </clr-alert>

                                        <button class="btn btn-primary" type="submit" [disabled]="editABForm.invalid || sampleListEditLocked" (click)="updateABSampleList(editABForm.value,selected)"
                                            [clrLoading]="submitLoading">Save Edits</button>
                                        <button class="btn btn-info" (click)="showHideEdit = !showHideEdit">Cancel</button>
                                    </div>
                                </div>
                            </clr-tab-content>
                        </ng-template>
                    </clr-tab>



                </clr-tabs>
            </div>
        </div>
    </div>

</clr-modal>

<!-- begin target detail modal -->
<clr-modal [(clrModalOpen)]="showHideTargetDetailModal" [clrModalSize]="'sm'">
    <h3 class="modal-title">Targets analyzed in Analysis Batch {{focusAnalysisBatchID}}</h3>
    <div class="modal-body">

        <div class="row">
            <div class="col-sm-12">

                <table class="table table-compact">
                    <thead>
                        <tr>
                            <th>Target</th>
                            <th>Type</th>
                            <th>Replicates</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let target of targetDetailArray">
                            <td>{{target.name}}</td>
                            <td>{{target.nucleic_acid_type}}</td>
                            <td>{{target.replicates}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</clr-modal>
<!-- end target detail modal -->

<!-- begin Analysis batches table -->
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-block">
                <div class="card-title">
                    All Analysis Batches
                </div>
                <div class="card-text">
                    <clr-datagrid [(clrDgSingleSelected)]="selectedAB">

                        <clr-dg-action-bar>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-secondary" [disabled]="!selectedAB" (click)="editAB(selectedAB)">
                                    <clr-icon shape="note-edit" size="16"></clr-icon> Edit Analysis Batch</button>
                                <button type="button" class="btn btn-sm btn-secondary" [disabled]="!selectedAB" (click)="extractAB(selectedAB)" [clrLoading]="submitLoading">
                                    <clr-icon shape="login"></clr-icon> Extract</button>
                                <!--<button type="button" class="btn btn-sm btn-secondary" ><clr-icon shape="printer"></clr-icon> Go</button>
                                <button type="button" class="btn btn-sm btn-secondary" > <clr-icon shape="trash"></clr-icon> Up</button>
                                <button type="button" class="btn btn-sm btn-secondary" ><clr-icon shape="note-edit"size="16"></clr-icon> Here</button> -->

                            </div>
                        </clr-dg-action-bar>

                        <clr-dg-column [clrDgField]="'analysis_batch_id'">
                            Analysis Batch ID
                            <clr-dg-filter [clrDgFilter]="rangeFilter">
                                <range-filter #rangeFilter></range-filter>
                            </clr-dg-filter>
                        </clr-dg-column>

                        <clr-dg-column [clrDgField]="'ab_description'">
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Analysis Batch Description
                            </ng-container>
                        </clr-dg-column>

                        <!-- <clr-dg-column [clrDgField]="'studies'">
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Studies
                            </ng-container>
                        </clr-dg-column> -->

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Extraction Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Inhibition Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                RT Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Target Count
                            </ng-container>
                        </clr-dg-column>

                        <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Analysis Batch Notes
                            </ng-container>
                        </clr-dg-column>


                        <!-- <clr-dg-column>
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Samples
                            </ng-container>
                        </clr-dg-column> -->

                        <clr-dg-column [clrDgField]="'insert_user'">
                            <ng-container *clrDgHideableColumn="{hidden: false}">
                                Added by
                            </ng-container>
                        </clr-dg-column>

                        <!-- filter column header for date added -->
                        <clr-dg-column [clrDgField]="'insert_date'">
                            Date Added
                            <clr-dg-filter [clrDgFilter]="dateAddedFilter">
                                <date-added-filter [dateField]="'insert_date'" #dateAddedFilter></date-added-filter>
                            </clr-dg-filter>
                        </clr-dg-column>

                        <clr-dg-column [clrDgField]="'update_user'">
                            <ng-container *clrDgHideableColumn="{hidden: true}">
                                Updated by
                            </ng-container>
                        </clr-dg-column>

                        <!-- filter column header for date updated -->
                        <clr-dg-column [clrDgField]="'update_date'">
                            Date Updated
                            <clr-dg-filter [clrDgFilter]="dateUpdatedFilter">
                                <date-updated-filter [dateField]="'update_date'" #dateUpdatedFilter></date-updated-filter>
                            </clr-dg-filter>
                        </clr-dg-column>

                        <!-- begin data table rows -->

                        <clr-dg-row *clrDgItems="let ab of allAnalysisBatchSummaries" [clrDgItem]="ab">

                            <clr-dg-cell>{{ab.id}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.analysis_batch_description}}</clr-dg-cell>
                            <!-- <clr-dg-cell><span *ngFor="let study of ab.studies">{{study.name}}<br></span></clr-dg-cell> -->

                            <clr-dg-cell>{{ab.summary.extraction_count}}</clr-dg-cell>

                            <clr-dg-cell>{{ab.summary.inhibition_count}}</clr-dg-cell>

                            <clr-dg-cell>{{ab.summary.reverse_transcription_count}}</clr-dg-cell>

                            <clr-dg-cell>
                                <a (click)="openTargetDetails(ab.id)" class="label label-blue clickable">{{ab.summary.target_count}}</a>
                            </clr-dg-cell>

                            <clr-dg-cell>{{ab.analysis_batch_notes}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.created_by}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.created_date | date:'shortDate'}}</clr-dg-cell>
                            <clr-dg-cell>{{ab.modified_by }}</clr-dg-cell>
                            <clr-dg-cell>{{ab.modified_date | date:'shortDate'}}</clr-dg-cell>

                            <analysis-batch-detail *clrIfExpanded [selectedABSummary]="ab" ngProjectAs="clr-dg-row-detail"></analysis-batch-detail>

                        </clr-dg-row>

                        <clr-dg-footer>
                            {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}} samples
                            <clr-dg-pagination #pagination [clrDgPageSize]="10"></clr-dg-pagination>
                        </clr-dg-footer>
                    </clr-datagrid>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end samples table -->