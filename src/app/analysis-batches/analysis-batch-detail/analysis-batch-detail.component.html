<div [clrLoading]="loading">
  <div class="row">
    <div class="col-sm-12 ">
      <!-- <hr class="ab-detail-header"> -->
      <!-- <span class="card-title ab-detail-header">Analysis Batch 1000 Details</span> -->
    </div>
  </div>
  <div class="row">
    <div class="col-lg-5 col-md-6 col-sm-12 col-xs-12">
      <div class="card ab-detail-card">
        <div class="card-block">
          <h3 class="card-title">Extractions</h3>
          <p class="card-text">
            <!-- <clr-tree-node>
              Analysis Batch {{selectedABDetail.id}}
              <ng-template [clrIfExpanded]="true"> -->

            <clr-tree-node *ngFor="let extraction of extractionDetailArray">
              Extraction # {{extraction.extraction_no}}<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>

              <button class="stack-action btn btn-sm btn-link btn-ab-detail-edit" (click)="editExtraction(extraction)" type="button">Edit</button>
              <ng-template clrIfExpanded>
                <clr-tree-node>
                  <table class="table table-vertical table-compact">
                    <tbody>
                      <!-- <tr>
                            <th>Extraction ID</th>
                            <td>{{extraction.id}}</td>
                          </tr> -->
                      <tr>
                        <th>Extraction Volume</th>
                        <td>{{extraction.extraction_volume}} µL</td>
                      </tr>
                      <tr>
                        <th>Elution Volume</th>
                        <td>{{extraction.elution_volume}} µL</td>
                      </tr>
                      <tr>
                        <th>Extraction Method</th>
                        <td>{{extraction.extraction_method | displayValue:'name':this.allExtractionMethods}}</td>
                      </tr>
                      <tr>
                        <th>Extraction Date</th>
                        <td>{{extraction.extraction_date | date:'shortDate'}}</td>
                      </tr>
                    </tbody>
                  </table>
                </clr-tree-node>

                <clr-tree-node>
                  Inhibitions
                  <ng-template clrIfExpanded>
                    <clr-tree-node *ngFor="let inhibition of extraction.inhibitions">
                      Inhibition {{inhibition.id}} ({{inhibition.type}})
                      <ng-template clrIfExpanded>
                        <clr-tree-node>
                          <table class="table table-vertical table-compact">
                            <tbody>
                              <tr>
                                <th>Inhibition Date</th>
                                <td>{{inhibition.inhibition_date | date:'shortDate' }}</td>
                              </tr>
                              <tr>
                                <th>Type</th>
                                <td>{{inhibition.type}}</td>
                              </tr>
                              <tr>
                                <th>Dilution Factor</th>
                                <td>{{inhibition.dilution_factor}}</td>
                              </tr>
                            </tbody>
                          </table>
                        </clr-tree-node>
                      </ng-template>
                    </clr-tree-node>
                  </ng-template>
                </clr-tree-node>

                <clr-tree-node>
                  Reverse Transcriptions
                  <ng-template clrIfExpanded>
                    <clr-tree-node *ngFor="let rt of extraction.reverse_transcriptions">
                      RT # {{rt.rt_no}}<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                      <button class="stack-action btn btn-sm btn-link btn-ab-detail-edit" (click)="editRT(rt)" type="button">Edit</button>
                      <ng-template clrIfExpanded>
                        <clr-tree-node>
                          <table class="table table-vertical table-compact">
                            <tbody>
                              <tr>
                                <th>Template Volume</th>
                                <td>{{rt.template_volume}} µL</td>
                              </tr>
                              <tr>
                                <th>Reaction Volume</th>
                                <td>{{rt.reaction_volume}} µL</td>
                              </tr>
                              <tr>
                                <th>Date</th>
                                <td>{{rt.rt_date | date:'shortDate'}}</td>
                              </tr>

                            </tbody>
                          </table>
                        </clr-tree-node>
                      </ng-template>
                    </clr-tree-node>
                  </ng-template>
                </clr-tree-node>

                <clr-tree-node>
                  Targets <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <button class="stack-action btn btn-sm btn-link btn-ab-detail-edit"
                    (click)="editExtractionTargets(extraction)" type="button">Edit</button>
                  <ng-template clrIfExpanded>
                    <ul class="list compact">
                      <li *ngFor="let target of extraction.targets">{{target.name}} ({{target.type}})</li>
                    </ul>
                  </ng-template>
                </clr-tree-node>
              </ng-template>
            </clr-tree-node>
            <!-- </ng-template>
            </clr-tree-node> -->
          </p>
        </div>
      </div>
    </div>
    <div class="col-lg-5 col-md-6 col-sm-12 col-xs-12">
      <div class="card ab-detail-card">
        <div class="card-block">
          <h3 class="card-title">Samples</h3>
          <p class="card-text">


            <clr-tree-node *ngFor="let extraction of extractionDetailArray">
              Sample {{extraction.extraction_no}}
              <ng-template clrIfExpanded>
                <clr-tree-node>
                  <table class="table table-vertical table-compact">
                    <tbody>
                      <tr>
                        <th>Collaborator ID</th>
                        <td>56732</td>
                      </tr>
                      <tr>
                        <th>Study</th>
                        <td>Kewuanee County Study</td>
                      </tr>
                    </tbody>
                  </table>
                </clr-tree-node>
              </ng-template>
            </clr-tree-node>

          </p>
        </div>
      </div>
    </div>
  </div>
</div>



<clr-modal class="modal-sm" [(clrModalOpen)]="showHideEditExtractionDetail">
  <h3 class="modal-title">Edit extraction</h3>
  <div class="modal-body">
    <span>Analysis Batch {{selectedABDetail.id}}</span>
    <form id="editExtractionForm" class="compact" [formGroup]="editExtractionForm" (ngSubmit)="onSubmit('edit', editExtractionForm.value)"
      [hidden]="submitted">
      <section class="form-block">
        <div class="form-group">
          <label for="extractionNo">Extraction No.</label>
          <input type="text" id="extractionNo" size="10" formControlName="extraction_no" readonly>
        </div>
        <div class="form-group">
          <label for="extractionVol">Extraction Volume</label>
          <input type="text" id="extractionVol" size="10" formControlName="extraction_volume">
        </div>
        <div class="form-group">
          <label for="extractionVol">Elution Volume</label>
          <input type="text" id="elutionVol" size="10" formControlName="elution_volume">
        </div>
        <div class="form-group">
          <label for="elutionVol">Extraction Method</label>
          <div class="select">
            <select id="extractionMethodSelect" name="extraction_method" formControlName="extraction_method">
                    <option *ngFor="let method of allExtractionMethods" [value]="method.id">{{method.name}}</option>
                </select>
          </div>
        </div>
        <div class="form-group">
          <label for="extractionDateInput">Extraction Date</label>
          <input type="date" id="extractionDateInput" formControlName="extraction_date">
        </div>

        <button class="btn btn-primary" type="submit" [disabled]="editExtractionForm.invalid">Save Edits</button>
        <button class="btn btn-info" (click)="showHideEditExtractionDetail = !showHideEditExtractionDetail">Cancel</button>
      </section>
    </form>
  </div>
</clr-modal>

<clr-modal class="modal-sm" [(clrModalOpen)]="showHideEditRTDetail">
  <h3 class="modal-title">Edit RT Details</h3>
  <div class="modal-body">
    <span>Analysis Batch {{selectedABDetail.id}}</span>

    <form id="editRTForm" class="compact" [formGroup]="editRTForm" (ngSubmit)="onSubmit('edit', editRTForm.value)">
      <section class="form-block">

        <div class="form-group">
          <label for="rtNo">RT No.</label>
          <input type="text" id="rtNo" size="10" formControlName="rt_no" readonly>
        </div>

        <div class="form-group">
          <label for="templateVol">Template Volume</label>
          <input id="templateVol" type="text" size="10" formControlName="template_volume">
          <div class="select">
            <select id="rtTemplateVolUnits" formControlName="template_volume_units">
                                <option *ngFor="let unit of units" [value]="unit.id">{{unit.name}}</option>
                            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="reactionVol">Reaction Volume</label>
          <input id="reactionVol" type="text" size="10" formControlName="reaction_volume">
          <div class="select">
            <select id="rtReactionVolUnits" formControlName="reaction_volume_units">
                                <option *ngFor="let unit of units" [value]="unit.id">{{unit.name}}</option>
                            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="templateVol">RT Cq Value</label>
          <input id="rt_cq" type="text" size="10" formControlName="rt_cq">
        </div>

        <div class="form-group">
          <label for="rtDateInput">RT Date</label>
          <input type="date" id="rtDateInput" formControlName="rt_date">
        </div>

        <button class="btn btn-primary" type="submit" [disabled]="editRTForm.invalid">Save Edits</button>
        <button class="btn btn-info" (click)="showHideEditRTDetail= !showHideEditRTDetail">Cancel</button>

      </section>
    </form>


  </div>
</clr-modal>

<!-- edit target list modal -->
<clr-modal [(clrModalOpen)]="showHideEditTargetList" [clrModalSize]="'xl'">
  <h3 class="modal-title">Edit Target List for Extraction # {{currentExtractionNo}} </h3>
  <div class="modal-body">

    <div class="row">
      <div class="col-lg-12">

        <!-- <clr-alert [clrAlertClosable]="false" *ngIf="targetListEditLocked">
          <div clr-alert-item class="alert-item">
            <span class="alert-text">
            This Analysis Batch has been extracted. Editing of the target list is locked. 
            </span>
          </div>
        </clr-alert> -->

        <form *ngIf="!targetListEditLocked">
          <section class="form-block">

            <clr-datagrid class="target-select-datagrid" [(clrDgSelected)]="selected">

              <clr-dg-column [clrDgField]="'name'">Name</clr-dg-column>
              <clr-dg-column [clrDgField]="'code'">Code</clr-dg-column>
              <clr-dg-column [clrDgField]="'type'">Type</clr-dg-column>
              <!-- <clr-dg-column [clrDgField]="'type'">Replicates</clr-dg-column> -->

              <clr-dg-row *clrDgItems="let target of allTargets" [clrDgItem]="target">
                <clr-dg-cell>{{target.name}}</clr-dg-cell>
                <clr-dg-cell>{{target.code}}</clr-dg-cell>
                <clr-dg-cell>{{target.type}}</clr-dg-cell>
                <!-- <clr-dg-cell>{{target.replicates}}</clr-dg-cell> -->
              </clr-dg-row>

              <clr-dg-footer>{{allTargets.length}} targets</clr-dg-footer>
            </clr-datagrid>

          </section>
        </form>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <button class="btn btn-primary" type="submit" (click)="updateABTargetList()">Save Edits</button>
        <button class="btn btn-info" (click)="showHideEditTargetList = !showHideEditTargetList">Cancel</button>
      </div>
    </div>
  </div>
</clr-modal>